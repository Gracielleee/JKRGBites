class RouletteActivity : AppCompatActivity(), SensorEventListener {
    private lateinit var sensorManager: SensorManager
    private var acceleration = 0f
    private var currentAcceleration = 0f
    private var lastAcceleration = 0f

    // Filters selected via UI (Bottom Nav or Chips)
    private var filterType = "Resto" // Cuisine, Category, or Resto
    private var currentMall = "SM North EDSA" 

    override fun onSensorChanged(event: SensorEvent) {
        val x = event.values[0]
        val y = event.values[1]
        val z = event.values[2]
        
        lastAcceleration = currentAcceleration
        currentAcceleration = kotlin.math.sqrt((x * x + y * y + z * z).toDouble()).toFloat()
        val delta = currentAcceleration - lastAcceleration
        acceleration = acceleration * 0.9f + delta

        if (acceleration > 12) { // Shake sensitivity threshold
            performRoulette()
        }
    }

    private fun performRoulette() {
        // 1. Get filtered list from your JSON
        val availableRestos = allRestos.filter { it.mall == currentMall }
        
        // 2. Pick based on user's set filter
        val result = when(filterType) {
            "Cuisine" -> availableRestos.map { it.cuisine }.distinct().random()
            "Category" -> availableRestos.map { it.category }.distinct().random()
            else -> availableRestos.random().name
        }
        
        showResultPopup(result)
    }
}